---
title: "2013 Grand Slams Tennis Data Interim Report"
author: "Önder Türe"
date: "2024-05-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library, include=FALSE}
library(knitr)
library(tidyverse)
library(ggplot2)
library(kableExtra)
library(reshape2)
```

## 1. Brief Statement of the aim of the project

In this project, data is 4 different tennis singles 2013 grand slams match statistics. In the data, there are different statistics about match like foul, number of firs serve win, and others that will be explained in the next part. Aim of the project is predict the result of the tennis match by using different match statistics. Another aim is to find most effective match statistics for the win, and how is change for different tournament and gender. To reach this aim, firstly, data will be cleaned and tidied for the EDA and CDA. Then, explanatory data analysis will be done to see how data distributed and to interpret variables effectively. After EDA, missing values will be handled and data manipulation and feature engineering will be done if it is necessary. After data preparation is done, Confirmatory data analysis will be done by considering EDA. Finally, for statistical modeling to predict match result cross-validation techniques will be used. Finally, statistical modeling will be performed and performance of statistical modeling will be investigated.

## 2. Source of the data variables, dependent variable

```{r combine_DF, include=FALSE}
## Getting data
AusOpenMen <- read.csv("https://raw.githubusercontent.com/boltainn/Tennis_project/main/tennis_data/AusOpen-men-2013.csv")
AusOpenWoMen <- read.csv("https://raw.githubusercontent.com/boltainn/Tennis_project/main/tennis_data/AusOpen-women-2013.csv")

FrenchOpenMen <- read.csv("https://raw.githubusercontent.com/boltainn/Tennis_project/main/tennis_data/FrenchOpen-men-2013.csv")
FrenchOpenWoMen <- read.csv("https://raw.githubusercontent.com/boltainn/Tennis_project/main/tennis_data/FrenchOpen-women-2013.csv")

USOpenMen <- read.csv("https://raw.githubusercontent.com/boltainn/Tennis_project/main/tennis_data/USOpen-men-2013.csv")
USOpenWoMen <- read.csv("https://raw.githubusercontent.com/boltainn/Tennis_project/main/tennis_data/USOpen-women-2013.csv")

WimbledonMen <- read.csv("https://raw.githubusercontent.com/boltainn/Tennis_project/main/tennis_data/Wimbledon-men-2013.csv")
WimbledonWoMen <- read.csv("https://raw.githubusercontent.com/boltainn/Tennis_project/main/tennis_data/Wimbledon-women-2013.csv")
##

##Combine all data and create new variables as "tournament" and "gender"

list_df <- list(AusOpenMen,AusOpenWoMen,FrenchOpenMen,FrenchOpenWoMen,USOpenMen,USOpenWoMen,WimbledonMen,WimbledonWoMen)

tournament_names<-c('AusOpen','AusOpen', 'FrenchOpen', 'FrenchOpen',
                   'USopen', 'USopen', 'Wimbledon', 'Wimbledon')

gender_name<- c('M','F','M','F','M','F','M','F')

## Adding two new variable
for(i in 1:8){
  tournament=rep(tournament_names[i],dim(list_df[[i]])[1])
  gender=rep(gender_name[i], dim(list_df[[i]])[1])
  list_df[[i]]$tournament=tournament
  list_df[[i]]$gender=gender
}

##Variable name fixing
col_names <- names(list_df[[3]])
for(i in 1:8){
  names(list_df[[i]]) = col_names
}

##Create combined data
GrandSlam <- rbind(list_df[[1]],list_df[[2]],list_df[[3]],list_df[[4]],list_df[[5]],list_df[[6]],
                    list_df[[7]],list_df[[8]])
## Create new dataset as one .csv file
write.csv(GrandSlam,file='GrandSlam2013.csv')

rm(list=ls())

GrandSlam <- read.csv('GrandSlam2013.csv',row.names = NULL, header=TRUE)
GrandSlam <- GrandSlam[,-1]
```

Source of the data is [UC Irvine Machine Learning Repository](https://archive.ics.uci.edu/dataset/300/tennis+major+tournament+match+statistics). In the source of the data, there is 8 different csv file. Each one represent different tournament from 2013 (Aus Open-Men,AusOpen-Women, USOpen-men,...). Data has 4 different tournament group by gender, so we have 8 different csv file data. All of the 8 csv data has same 42 variables, so all of them are combined to 1 csv file and 2 variable added as tournament and gender. At the end, data has 44 variable. Dependent variable is 'Result'. Our data have `r dim(GrandSlam)[1]` match observations.

| Name of Variable | Definition of Variable                                                                             |
|--------------------------|----------------------------------------------|
| Player 1         | Name of Player 1 (Nominal)                                                                         |
| Player 2         | Name of Player 2 (Nominal)                                                                         |
| Round            | Round of the tourneament (Nominal Ordinal) (1: 1st elimination round, 7: Final of the tournament ) |
| Result           | Result of the match (0/1) - Referenced on Player 1 is Result = 1 (Nominal)                         |
| FSP.1 and .2     | First Serve Percentage for player 1 (if .2, player 2) (Integer)                                    |
| FSW.1 and .2     | First Serve Won by player 1 (if .2, player 2) (Integer)                                            |
| SSP.1 and .2     | Second Serve Percentage for player 1 (if .2, player 2) (Integer)                                   |
| SSW.1 and .2     | Second Serve Won by player 1 (if .2, player 2) (Integer)                                           |
| ACE.1 and .2     | Aces won by player 1 (if .2, player 2) (Integer)                                                   |
| DBF.1 and .2     | Double Faults committed by player 1 (if .2, player 2) (Integer)                                    |
| WNR.1 and .2     | Winners earned by player 1 (if .2, player 2) (Integer)                                             |
| UFE.1 and .2     | Unforced Errors committed by player 1 (if .2, player 2) (Integer)                                  |
| BPC.1 and .2     | Break Points Created by player 1 (if .2, player 2) (Integer)                                       |
| BPW.1 and .2     | Break Points Won by player 1 (if .2, player 2) (Integer)                                           |
| NPA.1 and .2     | Net Points Attempted by player 1 (if .2, player 2) (Integer)                                       |
| NPW.1 and .2     | Net Points Won by player 1 (if .2, player 2) (Integer)                                             |
| TPW.1 and .2     | Total Points Won by player 1 (if .2, player 2) (Integer)                                           |
| ST1.1 and .2     | Set 1 result for Player 1 (if .2, player 2) (Integer)                                              |
| ST2.1 and .2     | Set 2 Result for Player 1 (if .2, player 2) (Integer)                                              |
| ST3.1 and .2     | Set 3 Result for Player 1 (if .2, player 2) (Integer)                                              |
| ST4.1 and .2     | Set 4 Result for Player 1 (if .2, player 2) (Integer)                                              |
| ST5.1 and .2     | Set 5 Result for Player 1 (if .2, player 2) (Integer)                                              |
| FNL.1 and .2     | Final Number of Games Won by Player 1 (if .2, player 2) (Integer)                                  |
| tournament       | Tournament name                                                                                    |
| gender           | Tournament gender                                                                                  |

: Variable Name and Definition

## 3. Data Cleaning and Tidying

Check variables and data types:

```{r structure, echo=FALSE}
kable(str(GrandSlam))
```

Character values, "Round" and "Result" should be a factor. And name of the variables should be all upper or lower letter. So, all names of variables changed to upper letter.

```{r upper, echo=FALSE}
## Change all varaiable names to upper letter
colnames(GrandSlam) <- toupper(colnames(GrandSlam))
```

Before change character values, "Round" and "Result" to factor let's check head and tail of the data set.

Head and tail of the data:

```{r head_tail, echo=FALSE}
kable(head(GrandSlam), label = "Head of the data")
kable(tail(GrandSlam),label = "Tail of the data")
```

As seen on the "PLAYER1" and "PLAYER2", there is problem about how player names saved to data. In some rows player names saved as full name (first name + surname). However, in other rows, player names saved as shortened way like "M.Bartolli". This problem fixed by convert all names shortened.

```{r convert_player, include=FALSE}
#Function that shortened names as like "M.Bartolli"
convert_player_name <- function(player_name){
  name_parts <- strsplit(player_name, " ")[[1]]
  first_name <- name_parts[1]
  if(grepl("\\.", first_name) & (!grepl("\\.\\s", player_name))){
    return(first_name)
  }
  else if(grepl("\\-", first_name)){
    other_names <- name_parts[-1]
    first_name_parts <- strsplit(first_name, "-")[[1]]
    first_name_parts_1 <- first_name_parts[1]
    first_name_parts_2 <- first_name_parts[2]
    first_initial_1 <- substr(first_name_parts_1, 1, 1)
    first_initial_2 <- substr(first_name_parts_2, 1, 1)
    first_initial <- paste0(first_initial_1, "-", first_initial_2)
    remaining_name <- paste(name_parts[-1], collapse = " ")
    new_name <- paste0(first_initial, ".", remaining_name)
    return(new_name)
  }
  else {
    other_names <- name_parts[-1]
    first_initial <- substr(first_name, 1, 1)
    remaining_name <- paste(name_parts[-1], collapse = " ")
    new_name <- paste0(first_initial, ".", remaining_name)
    return(new_name)
  }
}
# Apply the function to each element of the player name column
converted_names_1 <- sapply(GrandSlam$PLAYER1, convert_player_name)
converted_names_2 <- sapply(GrandSlam$PLAYER2, convert_player_name)
GrandSlam$PLAYER1<- converted_names_1
GrandSlam$PLAYER2 <- converted_names_2

#There is some cases names are saved diffrent way for the same player, This function fixed that problem
fixed_name <- function(player_name){
  if(grepl("T.De",player_name) | grepl("T.de",player_name)){
    return("T.De Bakker")
  }
  if(grepl("P.Carreno",player_name)){
    return("P.Carreno")
  }
  if(grepl("Koehler",player_name)){
    return("M.Koehler")
  }
  if(grepl("Pliskova",player_name)){
    return("K.Pliskova")
  }
  if(grepl("Struff",player_name)){
    return("J.Struff")
  }
  if(grepl("Struff",player_name)){
    return("J.Struff")
  }
  if(grepl("Begu",player_name)){
    return("I.Begu")
  }
  if(grepl("C.Suarez",player_name)){
    return("C.Suarez")
  }
  if(grepl("C.Wozniack",player_name)){
    return("C.Wozniack")
  }
  if(grepl("B.Zahlavova",player_name)){
    return("B.Zahlavova")
  }
  if(grepl("A.Medina",player_name)){
    return("A.Medina")
  }
  if(grepl("A.Bogomolov",player_name)){
    return("A.Bogomolov")
  }
  if(grepl("Schmiedlova",player_name)){
    return("A.Schmiedlova")
  }
  if(grepl("Torro-Flor",player_name)){
    return("M.Torro-Flor")
  }
  else{
    return(player_name)
  }
}

fixed1 <- sapply(GrandSlam$PLAYER1,fixed_name)
fixed2 <- sapply(GrandSlam$PLAYER2,fixed_name)
GrandSlam$PLAYER1 <- fixed1
GrandSlam$PLAYER2 <- fixed2
all_player=c(GrandSlam$PLAYER1,GrandSlam$PLAYER2)
length(unique(all_player))
```

After fixed player names, there is `r length(unique(all_player))` player on this data set.

```{r head_tail2, echo=FALSE}
kable(head(GrandSlam), label = "Head of the data")
kable(tail(GrandSlam),label = "Tail of the data")
```

As seen on the head and tail of the data, data seems well tabulated data. There is no unnecessary columns. There is `r sum(duplicated(GrandSlam))` duplicated observations in the data set. Player names fixed too.

Now character values, "Round" and "Result" can be changed to factor. And finalize structure of the data is below:

```{r factorize, echo=FALSE}
## Change 'Result' value for player-1 1 and player-2 2:
GrandSlam$RESULT <- ifelse(GrandSlam$RESULT==0, 2,1)
## Convert variables to factor
GrandSlam$PLAYER1 <- factor(GrandSlam$PLAYER1)
GrandSlam$PLAYER2 <- factor(GrandSlam$PLAYER2)
GrandSlam$RESULT <-factor(GrandSlam$RESULT)
GrandSlam$ROUND <-factor(GrandSlam$ROUND)
GrandSlam$TOURNAMENT <-factor(GrandSlam$TOURNAMENT)
GrandSlam$GENDER <-factor(GrandSlam$GENDER)
str(GrandSlam)
```

Also there is problem about BPC(Break Points Created) and BPW(Break Points Win). Logically, BPC must be greater or equal to BPW but in some rows BPC is lower than BPW like below example. This fixed by exchanging BPC values by BPW and BPW values by BPC when BPW \> BPC.

```{r BPC_BPW_problem, echo=FALSE}
cond<-which(GrandSlam$BPW.1>GrandSlam$BPC.1)
head(GrandSlam[cond,c("BPC.1","BPW.1","BPC.2","BPW.2")])

for(i in 1:length(GrandSlam$PLAYER1)){
  if (!is.na(GrandSlam$BPC.1[i] < GrandSlam$BPW.1[i])){
    if(GrandSlam$BPC.1[i] < GrandSlam$BPW.1[i]){
    old_BPC <- GrandSlam$BPC.1[i]
    old_BPW <- GrandSlam$BPW.1[i]
    GrandSlam$BPC.1[i] <- old_BPW
    GrandSlam$BPW.1[i] <- old_BPC
  }
  if(GrandSlam$BPC.2[i] < GrandSlam$BPW.2[i]){
    old_BPC <- GrandSlam$BPC.2[i]
    old_BPW <- GrandSlam$BPW.2[i]
    GrandSlam$BPC.2[i] <- old_BPW
    GrandSlam$BPW.2[i] <- old_BPC
  }
  }
}
```

After fix the problem, all BPC values are greater than BPW.

```{r BPC_BPW_new, echo=FALSE}
head(GrandSlam[cond,c("BPC.1","BPW.1","BPC.2","BPW.2")])
```

## 4. Explanatory Data Analysis

### Summary Statistics

Below there are frequency tables for tournament, round, result and gender. Ausopen and French open tournaments have most number of match. Also, as expected most matches played at round 1. Number of male matches are greater than female matches. Moreover, Most round 1 matches played at US open, but at the remaining round US Open matches are not much when considering other tournaments. There can be incomplete data for US Open.

```{r freq_table, echo=FALSE}
## Frequency table for categorical
kable(table(GrandSlam$TOURNAMENT),col.names = c('Tournament','Freq'))
kable(table(GrandSlam$ROUND),col.names = c('Round','Freq'))
kable(table(GrandSlam$RESULT),col.names = c('Result','Freq'))
kable(table(GrandSlam$GENDER),col.names = c('Gender','Freq'))

kable(table(GrandSlam$TOURNAMENT,GrandSlam$ROUND))
```

Summary statistics for numeric variables are below. Avarage performances are almost equal for player 1 and player 2 statistics. Avarage performance of tennis players can be seen in this summary statistics.

```{r summary, echo=FALSE}
sum1<-GrandSlam %>%
  select(PLAYER1,PLAYER2)
sum2 <-GrandSlam %>% 
  select(FSP.1,FSP.2,FSW.1,FSW.2 )
sum3 <-GrandSlam %>% 
  select(SSP.1,SSP.2,SSW.1,SSW.2 )
sum4 <-GrandSlam %>% 
  select(ACE.1,ACE.2,DBF.1,DBF.2)
sum5 <-GrandSlam %>% 
  select(WNR.1,WNR.2, UFE.1,UFE.2)
sum6 <-GrandSlam %>% 
  select(BPC.1,BPC.2,BPW.1,BPW.2)
sum7 <-GrandSlam %>% 
  select(NPA.1,NPA.2,NPW.1,NPW.2,TPW.1,TPW.2 )
summary(sum1)
summary(sum2)
summary(sum3)
summary(sum4)
summary(sum5)
summary(sum6)
summary(sum7)
```

Also, set result summary is like below, as seen, there are a lot of NA values for ST4 and ST5 especially. This is because most of the match is not last to 5 or 4 set. It is over in 2 or 3 sets.

```{r set_sum}
sum8 <-GrandSlam %>% 
  select(ST1.1,ST2.1,ST3.1,ST4.1,ST5.1)
sum9 <-GrandSlam %>% 
  select(ST1.2,ST2.2,ST3.2,ST4.2,ST5.2)
summary(sum8)
summary(sum9)
```

### Research Questions

#### How does number of break points win (BPW) and break points created (BPC) corralete between 2 player according to result?

As seen in the scatter plot, there is correlation between result and break points win. If player has more break points than opponent player, then, player that has more BPW and BPC probably win the match.

```{r EDA_1, echo=FALSE, warning=FALSE}
GrandSlam %>%
  ggplot(aes(x=BPW.1,y=BPW.2,fill = RESULT,colour=RESULT))+
  geom_point()+
  geom_jitter()+
  labs(title = "Scatter Plot of BPW.1 and BPW.2 by Result")+
  theme_bw()
  
GrandSlam %>%
  ggplot(aes(x=BPC.1,y=BPC.2,fill = RESULT, colour = RESULT))+
  geom_point()+
  labs(title = "Scatter Plot of BPC.1 and BPC.2 by Result")+
  theme_bw()
```

#### How does change distribution of first serve percentage (FSP) and First serve winning (FSW) for winning and losing player?

As seen on the density plot, when player win the match, player's first serve percentage is increase. Therefore, first serve percentage can be effective for winning the match. Similarly, box plot of FSP show that winner player has more FSW than loser one. So, having more FSW can effect the result.

```{r FSP_dens, echo=FALSE, warning=FALSE}
GrandSlam %>%
  ggplot(aes(x=FSP.1,fill = "blue"))+
  geom_density(alpha = 0.4,fill = "blue")+
  geom_density(aes(x=FSP.2,fill = "red"),alpha = 0.4, fill = "red")+
  labs(title="Density Plot of First Serve Percentage group by Result",x="FSP.1(blue) and FSP.2(red)")+
  facet_wrap(~RESULT)+
  theme_bw()

GrandSlam %>%
  ggplot(aes(y=FSW.1,fill = RESULT))+
  geom_boxplot()+
  facet_wrap(~RESULT)+
  theme_bw()

GrandSlam %>%
  ggplot(aes(y=FSW.2,fill = RESULT))+
  geom_boxplot()+
  facet_wrap(~RESULT)+
  theme_bw()
```

#### How does distribution of number of double faul (DBF) and aces (ACE) change for different tournaments grouped by gender?

On this part, ACE variable is created by summing of ACE.1 and ACE.2. Similarly other variables are summing and total of player 1 and player 2 statistic variables are created. Aim of this research is investigating effect of different tournament on player performance. Each tournament have different surface type so this should be effect the match statistics. As seen in the boxplots, at French open tournament, players do less ace than other tounaments. Clay surface (French open surface) can lead to this, because clay surface slow down the ball. Also, in the boxplot of DBF, we can say that players do more double foul at the US and AUS open tournaments. Both tournaments has hard surfaces. Additionally, there is significant diffrence on male and female statistics for ACE, male can do more ACE than womwn according to this graph but number of sets are not same for male and female matches. Female matches are best of 3, but male matches are best of 5. So, this can be reason for that.

```{r EDA_3, echo=FALSE, warning=FALSE}
GrandSlam <- GrandSlam %>%
  mutate(TPW=TPW.1+TPW.2,FSW=FSW.1+FSW.2,
        SSW=SSW.1+SSW.2,ACE=ACE.1+ACE.2,DBF=DBF.1+DBF.2, WNR=WNR.1+WNR.2,
         UFE=UFE.1+UFE.2, BPC =BPC.1+BPC.2, BPW=BPW.1+BPW.2, NPA=NPA.1+NPA.2,
         NPW=NPW.1+NPW.2)

ggplot(GrandSlam,aes(y=ACE,fill=TOURNAMENT))+
  geom_boxplot()+
  facet_wrap(~GENDER)+
  ggtitle("Boxplot of ACE for each tournement group by gender")+
  theme_bw()

ggplot(GrandSlam,aes(y=DBF,fill=TOURNAMENT))+
  geom_boxplot()+
  facet_wrap(~GENDER)+
  ggtitle("Boxplot of DBF for each tournement group by gender")+
  theme_bw()
```

#### Are there differences in the net points attempt (NPA) and net points win (NPW) by players across different rounds of the tournament by result?

NPA and NPW has right skewed distribution for each round except 7th round, but in 7th round we have 8 observation so it can mislead the interpretation of this plot for 7th round. Therefore player NPA and NPW performances are similar for all rounds except 7th.

```{r EDA_4,echo=FALSE, warning=FALSE}
ggplot(GrandSlam,aes(y=NPA,x=ROUND,fill = ROUND))+
  geom_violin()+
  ggtitle("Violin Plot of NPA for each Round")+
  theme_bw()

ggplot(GrandSlam,aes(y=NPW,x=ROUND,fill = ROUND))+
  geom_violin()+
  ggtitle("Violin Plot of NPW for each Round")+
  theme_bw()
```

#### Is there any correlation between number of break points created (BPC), total points win (TPW) and first serve percentage (FSP)?

As seen on bubble plot, whwn BPC increase, TPW increase because when player break the opponent player serve, match can be extend. Also number of first serve win tend to increase when TPW and BPC increase.

```{r EDA_5, echo=FALSE, warning=FALSE}
ggplot(GrandSlam,aes(x=TPW,y=BPC,size = FSW))+
  geom_point(colour = "purple", alpha = 0.4)+
  labs(title="Scatter plot of TPW vs BPC size by FSW")+
  theme_bw()

GrandSlam <- GrandSlam %>%
  select(-c(TPW,FSW,
        SSW,ACE,DBF, WNR,
         UFE, BPC , BPW, NPA,
         NPW))
```

## 5. Missing Observations and Imputation

Firstly, we should find NA values. As we look at the number of NA observations of variables that include NA (below), we can see there are `r sum(is.na(GrandSlam))` NA values

```{r NA_DF, echo=FALSE, warning=FALSE}
na_columns <- GrandSlam %>%
  select_if(~ any(is.na(.)))

colSums(is.na(na_columns))
```

For, FNL.1 and FNL.2 NA values are because of cancelled match. At the [link](https://www.tennisabstract.com/cgi-bin/wplayer-classic.cgi?p=AlizeCornet&f=A2014qqC2), you can see this match (date 13.01.2014) is cancelled. This row is removed from data set.

```{r NA_2, echo=FALSE, warning=FALSE}
GrandSlam %>%
  filter(is.na(FNL.1))

GrandSlam <- GrandSlam %>%
  filter(!is.na(FNL.1))
```


```{r NA_3, echo=FALSE, warning=FALSE}
NA_ace <- GrandSlam %>%
  filter(is.na(ACE.1))
```
